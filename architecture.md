# 新アーキテクチャ設計案

この設計は，「旅行」という大きな枠組みの中に，複数の「移動区間」が存在し，各移動区間が「出発地」と「目的地」という2つの「スポット」を繋ぐ，という現実の旅の構造を忠実にモデル化します．

## 1. 主要モデルの役割

### a. Trip (旅行) - 旅の全体像
*   **役割**: 一つの旅行全体（例:「2025年 夏の北海道旅行」）を管理します．
*   **主なカラム**: `title`, `start_date`, `end_date`, `trip_type`
*   **変更点**: 変更なし．旅のコンテナとしての役割は同じです．

### b. Spot (スポット) - 地図上の「点」
*   **役割**: 訪れた場所，出発地，目的地，経由地など，**地図上の具体的な「点」**を表します．
*   **主なカラム**: `name`, `description`, `prefecture`, `location` (PostGISのpoint型)
*   **変更点**: 到着時間や移動手段といった情報は，次の「移動区間」モデルに移譲します．より純粋な「場所」の情報に特化します．

### c. Transportation (移動手段) - マスターデータ
*   **役割**: (新規作成) 「電車」「バス」「車」といった，利用可能な全ての移動手段のマスターデータを管理するテーブルです．
*   **主なカラム**:
    *   `category`: "電車", "バス", "徒歩" などの大分類．
    *   `name`: "京王線", "JR中央線", "深夜バス" などの具体的な名称．

### d. Leg (移動区間) - 点と点を繋ぐ「線」
*   **役割**: (新規作成) このアーキテクチャの心臓部です．あるスポットから次のスポットへの，一つの移動を表します．
*   **主なカラム**:
    *   `trip_id`: どのTripに属するか．
    *   `origin_spot_id`: 出発地のSpot ID．
    *   `destination_spot_id`: 目的地のSpot ID．
    *   `transportation_id`: 利用したTransportationのID．
    *   `departure_time`: 出発日時．
    *   `arrival_time`: 到着日時．
    *   `path`: (将来的に) PostGISのLINESTRING型で，実際の移動ルート（線）を保存．

## 2. この設計のメリット
*   **PostGISとの親和性**: Spot（点）とLegのpath（線）を組み合わせることで，旅のルートを地図上に美しく，かつ正確に描画できます．
*   **柔軟なデータ構造**: 「東京駅 → (JR中央線) → 新宿駅 → (徒歩) → 東京都庁」のような，複雑な乗り換えや移動の連続を，複数のLegレコードとして正確に記録できます．
*   **拡張性**: 将来的に交通費や移動距離などの情報をLegモデルに追加するのも簡単です．
